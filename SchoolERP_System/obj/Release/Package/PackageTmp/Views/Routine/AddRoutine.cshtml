
@{
    ViewBag.Title = "Add Routine";
    Layout = "~/Views/Shared/_SuperAdminLayout.cshtml";
}
<style>
    .modal-confirm {
        color: #636363;
        width: 400px;
    }

        .modal-confirm .modal-content {
            padding: 20px;
            border-radius: 5px;
            border: none;
            text-align: center;
            font-size: 14px;
        }

        .modal-confirm .modal-header {
            border-bottom: none;
            position: relative;
        }

        .modal-confirm h4 {
            text-align: center;
            font-size: 26px;
            margin: 30px 0 -10px;
        }

        .modal-confirm .close {
            position: absolute;
            top: -5px;
            right: -2px;
        }

        .modal-confirm .modal-body {
            color: #999;
        }

        .modal-confirm .modal-footer {
            border: none;
            text-align: center;
            border-radius: 5px;
            font-size: 13px;
            padding: 10px 15px 25px;
        }

            .modal-confirm .modal-footer a {
                color: #999;
            }

        .modal-confirm .icon-box {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            border-radius: 50%;
            z-index: 9;
            text-align: center;
            border: 3px solid #f15e5e;
        }

            .modal-confirm .icon-box i {
                color: #f15e5e;
                font-size: 46px;
                display: inline-block;
                margin-top: 13px;
            }

        .modal-confirm .btn {
            color: #fff;
            border-radius: 4px;
            background: #60c7c1;
            text-decoration: none;
            transition: all 0.4s;
            line-height: normal;
            min-width: 120px;
            border: none;
            min-height: 40px;
            border-radius: 3px;
            margin: 0 5px;
            outline: none !important;
        }

        .modal-confirm .btn-info {
            background: #c1c1c1;
        }

            .modal-confirm .btn-info:hover, .modal-confirm .btn-info:focus {
                background: #a8a8a8;
            }

        .modal-confirm .btn-danger {
            background: #f15e5e;
        }

            .modal-confirm .btn-danger:hover, .modal-confirm .btn-danger:focus {
                background: #ee3535;
            }

    .trigger-btn {
        display: inline-block;
        margin: 100px auto;
    }

    .btn-group, .btn-group-vertical {
        padding: 2px;
    }

    .btn-secondary {
        color: #fff;
        background-color: #6c757d;
        border-color: #6c757d;
    }

    .dropdown-menu {
        -webkit-box-shadow: 0 0 35px 0 rgba(154,161,171,.15);
        box-shadow: 0 0 35px 0 rgba(154,161,171,.15);
    }

        .dropdown-menu[x-placement^=bottom], .dropdown-menu[x-placement^=left], .dropdown-menu[x-placement^=right], .dropdown-menu[x-placement^=top] {
            right: auto;
            bottom: auto;
        }

    .dropdown-item {
        display: block;
        width: 100%;
        padding: .375rem 1.5rem;
        clear: both;
        font-weight: 400;
        color: #6c757d;
        text-align: inherit;
        white-space: nowrap;
        background-color: transparent;
        border: 0;
    }

    a:not([href]):not([tabindex]) {
        color: inherit;
        text-decoration: none;
    }

    .show > .dropdown-menu {
        visibility: visible;
        opacity: 1;
        margin-top: 0 !important;
    }

    a, button {
        outline: 0 !important;
    }

    .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        z-index: 1000;
        display: none;
        float: left;
        min-width: 10rem;
        padding: .25rem 0;
        margin: .125rem 0 0;
        font-size: .875rem;
        color: #6c757d;
        text-align: left;
        list-style: none;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #d9e3e9;
        border-radius: .25rem;
    }
</style>
<div class="row" id="div_Scroll">
    <div class="col-lg-12">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <span class="pull-left">Add Routine</span>
                <button class="btn btn-default pull-right openModal m-t-10">Add Class Routine</button>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel-body">
                        @Html.Partial("~/Views/Shared/SuccessError.cshtml")
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label">Class Name:</label>
                                @Html.DropDownList("ddlClassList", (IList<SelectListItem>)ViewBag.ClassList, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label">Section:</label>
                                <select id="ddlSectionList" class="form-control"> </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label">Teacher:</label>
                                @Html.DropDownList("ddlTeacherLst", (IList<SelectListItem>)ViewBag.TeacherList, new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <button type="button" class="btn btn-primary" style="margin-top: 20px;" id="btnSearch">Filter</button>

                                @{
                                    string AppID = Convert.ToString(HttpContext.Current.Session["AppID"]).ToString();
                                }
                                <button type="button" class="btn btn-primary" style="margin-top: 20px;" id="btnPrint" AppId="@AppID">Print</button>
                            </div>
                        </div>

                        <div id="stlist" class="row">
                            <div class="col-lg-12">
                                <div class="panel-body">

                                    <div ID="dvContents">
                                        <table id="tblMapping" class="table table-striped table-bordered table-centered mb-0">
                                            <tbody>
                                                @*<tr>
                                    <td style="font-weight: bold; width : 100px;">Saturday</td>

                                    <td class="m-1">

                                        <div class="btn-group text-left">
                                            <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                                <p style="margin-bottom: 0px;">
                                                    <i class="fa fa-book" style="color:white;"></i>
                                                    Computer
                                                </p>
                                                <p style="margin-bottom: 0px;">
                                                    <i class="fa fa-clock-o" style="color:white;"></i>
                                                    10:0 - 11:0
                                                </p>
                                                <p style="margin-bottom: 0px;">
                                                    <i class="fa fa-user" style="color:white;"></i>
                                                    Lilla Marquardt
                                                </p>

                                                <span class="caret"></span>
                                            </button>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item" style="cursor:pointer;" onclick="rightModal('http://ekattor-school-erp.com/demo/v7/modal/popup/routine/edit/8', 'Update Routine');">Edit</a>
                                                <a class="dropdown-item" style="cursor:pointer;" onclick="confirmModal('http://ekattor-school-erp.com/demo/v7/superadmin/routine/delete/8', getFilteredClassRoutine)">Delete</a>
                                            </div>
                                        </div>

                                    </td>

                                </tr>
                                <tr>
                                    <td style="font-weight: bold; width : 100px;">Sunday</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold; width : 100px;">Monday</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold; width : 100px;">Tuesday</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold; width : 100px;">Wednesday</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold; width : 100px;">Thursday</td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold; width : 100px;">Friday</td>
                                </tr>*@
                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="hdId" value="0" />
<div class="modal fade" id="MasterModal" role="dialog" aria-labelledby="exampleModalLabel">

    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width:700px">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Add/Update Class Routine:</h4>
            </div>
            <div class="modal-body">
                @Html.Partial("~/Views/Shared/Modal_SuccessError.cshtml")
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label class="control-label">Days:<span style="color:red;">*</span></label>
                            <select id="ddlDaysList" class="form-control">
                                <option value="0">Select</option>
                                <option value="Monday">Monday</option>
                                <option value="Tuesday">Tuesday</option>
                                <option value="Wednesday">Wednesday</option>
                                <option value="Thursday">Thursday</option>
                                <option value="Friday">Friday</option>
                                <option value="Saturday">Saturday</option>
                                <option value="Sunday">Sunday</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Class:<span style="color:red;">*</span></label>
                            @Html.DropDownList("ddlClassAddList", (IList<SelectListItem>)ViewBag.ClassList, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="control-label">Section:<span style="color:red;">*</span></label>
                            <select id="ddlSectionAddList" class="form-control"> </select>
                        </div>
                    </div>

                </div>
                <div class="row">

                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Subject:<span style="color:red;">*</span></label>
                            @Html.DropDownList("ddlSubjectList", (IList<SelectListItem>)ViewBag.SubjectList, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Teacher:<span style="color:red;">*</span></label>
                            @Html.DropDownList("ddlTeacherList", (IList<SelectListItem>)ViewBag.TeacherList, new { @class = "form-control" })
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Starting Hour:<span style="color:red;">*</span></label>
                            <select id="ddlStartingHourList" class="form-control">
                                <option value="">Starting Hour</option>
                                @*<option value="0">12 AM</option>
        <option value="1">1 AM</option>
        <option value="2">2 AM</option>
        <option value="3">3 AM</option>
        <option value="4">4 AM</option>
        <option value="5">5 AM</option>*@
                                <option value="6">6 AM</option>
                                <option value="7">7 AM</option>
                                <option value="8">8 AM</option>
                                <option value="9">9 AM</option>
                                <option value="10">10 AM</option>
                                <option value="11">11 AM</option>
                                <option value="12">12 PM</option>
                                <option value="13">1 PM</option>
                                <option value="14">2 PM</option>
                                <option value="15">3 PM</option>
                                <option value="16">4 PM</option>
                                <option value="17">5 PM</option>
                                @*<option value="18">6 PM</option>
        <option value="19">7 PM</option>
        <option value="20">8 PM</option>
        <option value="21">9 PM</option>
        <option value="22">10 PM</option>
        <option value="23">11 PM</option>*@
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Starting Minute:<span style="color:red;">*</span></label>
                            <select id="ddlStartingMinuteList" class="form-control">
                                <option value="">Starting Minute</option>
                                <option value="0">0</option>
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="15">15</option>
                                <option value="20">20</option>
                                <option value="25">25</option>
                                <option value="30">30</option>
                                <option value="35">35</option>
                                <option value="40">40</option>
                                <option value="45">45</option>
                                <option value="50">50</option>
                                <option value="55">55</option>
                            </select>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Ending Hour:<span style="color:red;">*</span></label>
                            <select id="ddlEndingHourList" class="form-control">
                                <option value="">Ending Hour</option>
                                @*<option value="0">12 AM</option>
        <option value="1">1 AM</option>
        <option value="2">2 AM</option>
        <option value="3">3 AM</option>
        <option value="4">4 AM</option>
        <option value="5">5 AM</option>*@
                                <option value="6">6 AM</option>
                                <option value="7">7 AM</option>
                                <option value="8">8 AM</option>
                                <option value="9">9 AM</option>
                                <option value="10">10 AM</option>
                                <option value="11">11 AM</option>
                                <option value="12">12 PM</option>
                                <option value="13">1 PM</option>
                                <option value="14">2 PM</option>
                                <option value="15">3 PM</option>
                                <option value="16">4 PM</option>
                                <option value="17">5 PM</option>
                                @*<option value="18">6 PM</option>
                                <option value="19">7 PM</option>
                                <option value="20">8 PM</option>
                                <option value="21">9 PM</option>
                                <option value="22">10 PM</option>
                                <option value="23">11 PM</option>*@
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Ending Minute:<span style="color:red;">*</span></label>
                            <select id="ddlEndingMinuteList" class="form-control">
                                <option value="">Ending Minute</option>
                                <option value="0">0</option>
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="15">15</option>
                                <option value="20">20</option>
                                <option value="25">25</option>
                                <option value="30">30</option>
                                <option value="35">35</option>
                                <option value="40">40</option>
                                <option value="45">45</option>
                                <option value="50">50</option>
                                <option value="55">55</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btnSave">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal HTML -->
<div id="myModal" class="modal fade">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-header">
                <div class="icon-box">
                    <i class="material-icons">&#xE5CD;</i>
                </div>
                <h4 class="modal-title">Are you sure?</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
                <p>Do you really want to delete these records?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="btnDel">Delete</button>
            </div>
        </div>
    </div>
</div>
@section body_scripts{

    <script type="text/javascript">

        $(document).ready(function () {

            $("#ddlClassList").select2({
                placeholder: "Select"
            });

            $("#ddlSectionList").select2({
                placeholder: "Select"
            });
            $("#ddlClassAddList").select2({
                placeholder: "Select"
            });

            $("#ddlSectionAddList").select2({
                placeholder: "Select"
            });
            $("#ddlTeacherList").select2({
                placeholder: "Select"
            });
            $("#ddlSubjectList").select2({
                placeholder: "Select"
            });
            $("#ddlStartingHourList").select2({
                placeholder: "Select"
            });
            $("#ddlStartingMinuteList").select2({
                placeholder: "Select"
            });
            $("#ddlEndingHourList").select2({
                placeholder: "Select"
            });
            $("#ddlEndingMinuteList").select2({
                placeholder: "Select"
            });
            $("#ddlDaysList").select2({
                placeholder: "Select"
            });
            // $("#stlist").hide();
        });
        $(document).on("click", ".openModal", function () {
            HideSuccErrDiv();
            ModalHideSuccErrDiv();
            fn_resetformPopup();
            $("#MasterModal").modal();
        });
        $(document).on("click", "#btnDel", function () {
            var _Id = $.trim($("#hdId").val());
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeleteRoutine", "Routine")',
                data: JSON.stringify({ Id: _Id }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                cache: false,
                success: function (response) {
                    if (response == "deleteSuccessful") {
                        $("#hdId").val('0');
                        $('#myModal').modal('hide');
                        $("#btnSearch").click();
                    }
                    else {
                        alert("Error. Try again latet.");
                        return false;
                    }
                },
                error: function (error) {
                    console.error(error);
                    //FormSuccessError(error, "Error", "errorBlock");
                    return false;
                }
            });
        });
        $(document).on("click", "#btnSave", function () {
            ModalHideSuccErrDiv();
            var _Id = $.trim($("#hdId").val());
            var _ddl1 = $('#ddlClassAddList').val();
            var _ddl2 = $('#ddlSectionAddList').val();
            var _ddl3 = $("#ddlTeacherList").val();
            var _ddl4 = $("#ddlSubjectList").val();
            var _ddl5 = $("#ddlStartingHourList").val();
            var _ddl6 = $("#ddlStartingMinuteList").val();
            var _ddl7 = $("#ddlEndingHourList").val();
            var _ddl8 = $("#ddlEndingMinuteList").val();
            var _ddl9 = $("#ddlDaysList").val();

            if (_ddl9 == '' || _ddl9 <= 0) {
                ModalPopupError("Please select Days.", "Error", "M_errorBlock");
                return false;
            }
            if (_ddl1 == '' || _ddl1 <= 0) {
                ModalPopupError("Please select Class.", "Error", "M_errorBlock");
                return false;
            }
            if (_ddl2 == '' || _ddl2 <= 0) {
                ModalPopupError("Please select Section.", "Error", "M_errorBlock");
                return false;
            }
            if (_ddl4 == '' || _ddl4 <= 0) {
                ModalPopupError("Please select Subject.", "Error", "M_errorBlock");
                return false;
            }
            if (_ddl3 == '' || _ddl3 <= 0) {
                ModalPopupError("Please select Teacher.", "Error", "M_errorBlock");
                return false;
            }
            if (_ddl5 == '' || _ddl5 <= 0) {
                ModalPopupError("Please select Starting Hour.", "Error", "M_errorBlock");
                return false;
            }
            if (_ddl6 == '') {
                ModalPopupError("Please select Starting Minute.", "Error", "M_errorBlock");
                return false;
            }
            if (_ddl7 == '' || _ddl7 <= 0) {
                ModalPopupError("Please select Ending Hour.", "Error", "M_errorBlock");
                return false;
            }
            if (_ddl8 == '') {
                ModalPopupError("Please select Ending Minute.", "Error", "M_errorBlock");
                return false;
            }
            //alert(_ddl5);
            //alert(_ddl7);
            var startTime = _ddl5 + ':' + _ddl6 + ':' + 00;
            var endTime = _ddl7 + ':' + _ddl8 + ':' + 00;

            //var regExp = /(\d{1,2})\:(\d{1,2})\:(\d{1,2})/;
            //if (parseInt(endTime.replace(regExp, "$1$2$3")) < parseInt(startTime.replace(regExp, "$1$2$3"))) {
            //    alert("End time is greater");
            //    ModalPopupError("Please select Correct Hour & Minute.1", "Error", "M_errorBlock");
            //}
            if (parseInt(_ddl5) > parseInt(_ddl7)) {
                ModalPopupError("Please select Correct Hour & Minute.", "Error", "M_errorBlock");
                return false;
            }
            if (parseInt(_ddl5) == parseInt(_ddl7) && parseInt(_ddl6) > parseInt(_ddl8)) {
                ModalPopupError("Please select Correct Hour & Minute!", "Error", "M_errorBlock");
                return false;
            }
            $.ajax({
                type: "POST",
                url: '@Url.Action("saveRoutine", "Routine")',
                data: JSON.stringify({
                    Id: _Id, ClassID: _ddl1, SectionID: _ddl2, SubjectID: _ddl4, TeacherID: _ddl3, Days: _ddl9,
                    StHr: _ddl5, StMn: _ddl6, EnHr: _ddl7, EnMn: _ddl8
                }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                cache: false,
                success: function (response) {

                    if (response == "InsertSuccessful") {
                        fn_resetformPopup();
                        ModalPopupError("Data Inserted successfully.", "Success", "M_errorBlock");
                        //if ($('#ddlClassList').val() > 0 && $('#ddlSectionList').val() > 0)
                            $("#btnSearch").click();
                    }
                    else if (response == "UpdateSuccessful") {
                        fn_resetformPopup();
                        ModalPopupError("Data updated successfully.", "Success", "M_errorBlock");
                        //if ($('#ddlClassList').val() > 0 && $('#ddlSectionList').val() > 0)
                            $("#btnSearch").click();
                    }
                    else {
                        alert("Error. Try again latet. " + response);
                        return false;
                    }
                },
                error: function (error) {
                    console.error(error);
                    return false;
                }
            });

        });
        $(document).on("click", ".Icondelclass", function () {

            var _Id = $(this).attr('data-ID');
            $("#hdId").val(_Id);
            $("#myModal").modal();

        });
        $(document).on("click", ".Iconeditclass", function () {
            var _Id = $(this).attr('data-ID');
            $("#hdId").val(_Id);
            fn_Bindtbl(_Id);
        });
        function fn_Bindtbl(_Id) {
            $.ajax({
                type: "POST",
                url: '@Url.Action("viewRoutineEDIT", "Routine")',
                data: JSON.stringify({ Id: _Id }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                cache: false,
                success: function (data) {

                    $('#btnSave').text("Update");
                    $("#hdId").val(_Id);
                    $('#ddlClassAddList').select2("val", data[0].ClassID);
                    $('#ddlSectionAddList').select2("val", data[0].SectionID);
                    $("#ddlTeacherList").select2("val", data[0].TeacherID);
                    $("#ddlSubjectList").select2("val", data[0].SubjectID);
                    $("#ddlStartingHourList").select2("val", data[0].StHr);
                    $("#ddlStartingMinuteList").select2("val", data[0].StMn);
                    $("#ddlEndingHourList").select2("val", data[0].EnHr);
                    $("#ddlEndingMinuteList").select2("val", data[0].EnMn);
                    $("#ddlDaysList").select2("val", data[0].Days);
                    $("#MasterModal").modal();

                },
                error: function (error) {
                    console.error(error);
                    return false;
                }
            });
        }
        $(document).on("click", "#btnSearch", function () {

            var _ddl1 = $('#ddlClassList').val();
            var _ddl2 = $('#ddlSectionList').val();
            var _ddl3 = $('#ddlTeacherLst').val();

            //if (_ddl1 == '' || _ddl1 <= 0) {
            //    FormSuccessError1("Please Select Class.", "Error", "errorBlock", "div_Scroll");
            //    return false;
            //}
            //if (_ddl2 == '' || _ddl2 <= 0) {
            //    FormSuccessError1("Please Select Section.", "Error", "errorBlock", "div_Scroll");
            //    return false;
            //}
            $.ajax({
                type: "POST",
                url: '@Url.Action("viewRoutine", "Routine")',
                data: JSON.stringify({ Type: "Select", ClassID: _ddl1, SectionID: _ddl2, TeacherID: _ddl3 }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                cache: false,
                success: function (data) {
                    $('#tblMapping tbody').empty();
                    var row = '';
                    //Monday
                    row += '<tr><td style="font-weight: bold; width : 100px;">Monday</td><td class="m-1">';
                    $.each(data, function (rowIndex, val) {
                        if (val.Days == 'Monday') {
                            row += '<div class="btn-group text-left"><button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-book" style="color:white;"></i>' + val.SubjectName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-clock-o" style="color:white;"></i>' + val.StHr + ' - ' + val.EnHr + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-user" style="color:white;"></i>' + val.EM_EmpName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-graduation-cap" style="color:white;"></i>' + val.ClassName + ' (' + val.SectionName + ')' + '</p>';
                            row += '<span class="caret"></span></button><div class="dropdown-menu"><a class="dropdown-item Iconeditclass" style="cursor:pointer;" data-ID="' + val.RID + '">Edit</a><a class="dropdown-item Icondelclass" style="cursor:pointer;" data-ID="' + val.RID + '">Delete</a></div></div>';
                        }
                    });
                    row += '</td></tr>';

                    //Tuesday
                    row += '<tr><td style="font-weight: bold; width : 100px;">Tuesday</td><td class="m-1">';
                    $.each(data, function (rowIndex, val) {
                        if (val.Days == 'Tuesday') {
                            row += '<div class="btn-group text-left"><button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-book" style="color:white;"></i>' + val.SubjectName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-clock-o" style="color:white;"></i>' + val.StHr + ' - ' + val.EnHr + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-user" style="color:white;"></i>' + val.EM_EmpName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-graduation-cap" style="color:white;"></i>' + val.ClassName + ' (' + val.SectionName + ')' + '</p>';
                            row += '<span class="caret"></span></button><div class="dropdown-menu"><a class="dropdown-item Iconeditclass" style="cursor:pointer;" data-ID="' + val.RID + '">Edit</a><a class="dropdown-item Icondelclass" style="cursor:pointer;" data-ID="' + val.RID + '">Delete</a></div></div>';
                        }
                    });
                    row += '</td></tr>';

                    //Wednesday
                    row += '<tr><td style="font-weight: bold; width : 100px;">Wednesday</td><td class="m-1">';
                    $.each(data, function (rowIndex, val) {
                        if (val.Days == 'Wednesday') {
                            row += '<div class="btn-group text-left"><button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-book" style="color:white;"></i>' + val.SubjectName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-clock-o" style="color:white;"></i>' + val.StHr + ' - ' + val.EnHr + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-user" style="color:white;"></i>' + val.EM_EmpName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-graduation-cap" style="color:white;"></i>' + val.ClassName + ' (' + val.SectionName + ')' + '</p>';
                            row += '<span class="caret"></span></button><div class="dropdown-menu"><a class="dropdown-item Iconeditclass" style="cursor:pointer;" data-ID="' + val.RID + '">Edit</a><a class="dropdown-item Icondelclass" style="cursor:pointer;" data-ID="' + val.RID + '">Delete</a></div></div>';
                        }
                    });
                    row += '</td></tr>';

                    //Thursday
                    row += '<tr><td style="font-weight: bold; width : 100px;">Thursday</td><td class="m-1">';
                    $.each(data, function (rowIndex, val) {
                        if (val.Days == 'Thursday') {
                            row += '<div class="btn-group text-left"><button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-book" style="color:white;"></i>' + val.SubjectName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-clock-o" style="color:white;"></i>' + val.StHr + ' - ' + val.EnHr + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-user" style="color:white;"></i>' + val.EM_EmpName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-graduation-cap" style="color:white;"></i>' + val.ClassName + ' (' + val.SectionName + ')' + '</p>';
                            row += '<span class="caret"></span></button><div class="dropdown-menu"><a class="dropdown-item Iconeditclass" style="cursor:pointer;" data-ID="' + val.RID + '">Edit</a><a class="dropdown-item Icondelclass" style="cursor:pointer;" data-ID="' + val.RID + '">Delete</a></div></div>';
                        }
                    });
                    row += '</td></tr>';

                    //Friday
                    row += '<tr><td style="font-weight: bold; width : 100px;">Friday</td><td class="m-1">';
                    $.each(data, function (rowIndex, val) {
                        if (val.Days == 'Friday') {
                            row += '<div class="btn-group text-left"><button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-book" style="color:white;"></i>' + val.SubjectName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-clock-o" style="color:white;"></i>' + val.StHr + ' - ' + val.EnHr + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-user" style="color:white;"></i>' + val.EM_EmpName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-graduation-cap" style="color:white;"></i>' + val.ClassName + ' (' + val.SectionName + ')' + '</p>';
                            row += '<span class="caret"></span></button><div class="dropdown-menu"><a class="dropdown-item Iconeditclass" style="cursor:pointer;" data-ID="' + val.RID + '">Edit</a><a class="dropdown-item Icondelclass" style="cursor:pointer;" data-ID="' + val.RID + '">Delete</a></div></div>';
                        }
                    });
                    row += '</td></tr>';

                    //Saturday
                    row += '<tr><td style="font-weight: bold; width : 100px;">Saturday</td><td class="m-1">';
                    $.each(data, function (rowIndex, val) {
                        if (val.Days == 'Saturday') {
                            row += '<div class="btn-group text-left"><button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-book" style="color:white;"></i>' + val.SubjectName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-clock-o" style="color:white;"></i>' + val.StHr + ' - ' + val.EnHr + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-user" style="color:white;"></i>' + val.EM_EmpName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-graduation-cap" style="color:white;"></i>' + val.ClassName + ' (' + val.SectionName + ')' + '</p>';
                            row += '<span class="caret"></span></button><div class="dropdown-menu"><a class="dropdown-item Iconeditclass" style="cursor:pointer;" data-ID="' + val.RID + '">Edit</a><a class="dropdown-item Icondelclass" style="cursor:pointer;" data-ID="' + val.RID + '">Delete</a></div></div>';
                        }
                    });
                    row += '</td></tr>';

                    //Sunday
                    row += '<tr><td style="font-weight: bold; width : 100px;">Sunday</td><td class="m-1">';
                    $.each(data, function (rowIndex, val) {
                        if (val.Days == 'Sunday') {
                            row += '<div class="btn-group text-left"><button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-book" style="color:white;"></i>' + val.SubjectName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-clock-o" style="color:white;"></i>' + val.StHr + ' - ' + val.EnHr + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-user" style="color:white;"></i>' + val.EM_EmpName + '</p>';
                            row += '<p style="margin-bottom: 0px;"><i class="fa fa-graduation-cap" style="color:white;"></i>' + val.ClassName + ' (' + val.SectionName + ')' + '</p>';
                            row += '<span class="caret"></span></button><div class="dropdown-menu"><a class="dropdown-item Iconeditclass" style="cursor:pointer;" data-ID="' + val.RID + '">Edit</a><a class="dropdown-item Icondelclass" style="cursor:pointer;" data-ID="' + val.RID + '">Delete</a></div></div>';
                        }
                    });
                    row += '</td></tr>';
                    $('#tblMapping tbody').append(row);
                    // $("#btnPrint").css("display", "block");
                },
                error: function (error) {
                    console.error(error);
                    return false;
                }
            });

        });
        $("#ddlClassList").change(function () {

            var ID = $('option:selected', this).val();
            if (ID == '' || ID <= 0) {
                return false;
            }
            $.ajax({
                type: "POST",
                url: '/Student/BindStream',
                data: JSON.stringify({ ID: ID, Type: "Se" }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                cache: false,
                success: function (data) {
                    $("#ddlSectionList").empty().append('<option selected="selected" value="0">Select</option>');
                    if (data.length > 0) {
                        $.each(data, function () {
                            $("#ddlSectionList").append($("<option/>").val(this.SectionID).text(this.SectionName));
                        });
                    }
                }
            });
        });
        $("#ddlClassAddList").change(function () {

            var ID = $('option:selected', this).val();
            if (ID == '' || ID <= 0) {
                return false;
            }
            $.ajax({
                type: "POST",
                url: '/Student/BindStream',
                data: JSON.stringify({ ID: ID, Type: "Se" }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                cache: false,
                success: function (data) {
                    $("#ddlSectionAddList").empty().append('<option selected="selected" value="0">Select</option>');
                    if (data.length > 0) {
                        $.each(data, function () {
                            $("#ddlSectionAddList").append($("<option/>").val(this.SectionID).text(this.SectionName));
                        });
                    }
                }
            });
        });
        $(document).on("click", "#btnPrint", function () {
            var _AppId = $(this).attr('AppId');
            Print(_AppId);
        });
        function fn_resetform() {
            $("#hdId").val('0');
            $('#ddlClassList').select2("val", '');
            $('#ddlSectionList').select2("val", '');
            $('#tblMapping tbody').empty();
            $('#btnSave').text("Save");
        }
        function fn_resetformPopup() {
            $("#hdId").val('0');
            $('#ddlClassAddList').select2("val", '');
            $('#ddlSectionAddList').select2("val", '');
            $("#ddlTeacherList").select2("val", '');
            $("#ddlSubjectList").select2("val", '');
            $("#ddlStartingHourList").select2("val", '');
            $("#ddlStartingMinuteList").select2("val", '');
            $("#ddlEndingHourList").select2("val", '');
            $("#ddlEndingMinuteList").select2("val", '');
            $("#ddlDaysList").select2("val", '');
            $('#btnSave').text("Save");
        }
        function Print(AppID) {
            var final = {}; var master = []; var detail = [];

            master.push({
                ReportName: "Routine.rpt",
                FileName: "Class_Routine",
                AppID: AppID
            });

            detail.push({
                ClassID: $('#ddlClassList').val(),
                SectionID: $('#ddlSectionList').val(),
                TeacherID: $('#ddlTeacherLst').val(),
                AppID: AppID
            });

            final = {
                Master: master,
                Detail: detail
            }

            var left = ($(window).width() / 2) - (950 / 2),
                top = ($(window).height() / 2) - (650 / 2),
                popup = window.open("/OpenReport/OpenReports.aspx?ReportName=" + JSON.stringify(final), "popup", "width=950, height=650, top=" + top + ", left=" + left);
            popup.focus();
        }
    </script>
}




